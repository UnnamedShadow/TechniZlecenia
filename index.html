<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <!-- <link rel="icon" type="image/svg+xml" href="/vite.svg" /> -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vite + TS</title>
  <link rel="stylesheet" href="/src/style.css">
  <script type="module" src="/src/elements/owned-order-details.ts"></script>
  <script type="module" src="/src/elements/bookmark-provider.ts"></script>
  <script type="module" src="/src/elements/query-my-orders.ts"></script>
  <script type="module" src="/src/elements/query-my-offers.ts"></script>
  <script type="module" src="/src/elements/profile-picture.ts"></script>
  <script type="module" src="/src/elements/if-equal-view.ts"></script>
  <script type="module" src="/src/elements/template-list.ts"></script>
  <script type="module" src="/src/elements/query-profile.ts"></script>
  <script type="module" src="/src/elements/toggle-button.ts"></script>
  <script type="module" src="/src/elements/bookmark-list.ts"></script>
  <script type="module" src="/src/elements/text-display.ts"></script>
  <script type="module" src="/src/elements/query-search.ts"></script>
  <script type="module" src="/src/elements/create-form.ts"></script>
  <script type="module" src="/src/elements/router-view.ts"></script>
  <script type="module" src="/src/elements/side-panel.ts"></script>
  <script type="module" src="/src/elements/tab-button.ts"></script>
  <script type="module" src="/src/elements/paged-view.ts"></script>
  <script type="module" src="/src/elements/login-form.ts"></script>
  <script type="module" src="/src/elements/order-list.ts"></script>
  <script type="module" src="/src/elements/image-list.ts"></script>
  <script type="module" src="/src/elements/offer-list.ts"></script>
  <script type="module" src="/src/elements/route-list.ts"></script>
  <script type="module" src="/src/elements/tab-group.ts"></script>
  <script type="module" src="/src/elements/user-list.ts"></script>
  <script type="module" src="/src/elements/tab-list.ts"></script>
</head>

<body style="overflow: hidden;">
  <div style="flex-basis: 300px;">
    <side-panel>
      <nav style="height: 100%; display: flex; flex-direction: column; padding: 10px">
        <tab-group value="about" @value="main>paged-view%page">
          <tab-button value="about">About</tab-button>
          <tab-button value="browse">Browse</tab-button>
          <tab-button value="offers">My offers</tab-button>
          <tab-button value="orders">My orders</tab-button>
          <br />
          <tab-group class="bookmarks">
            <span>Bookmarks:</span>
            <bookmark-provider @tabs="tab-list%data" base='[{"tab": "browse", "content": []}]'
              @data="bookmark-list%data">
              <tab-list $value="tab-button%value" $text="text-display%content">
                <div slot="item">
                  <tab-button>
                    <text-display></text-display>
                  </tab-button>
                </div>
              </tab-list>
            </bookmark-provider>
          </tab-group>
          <br />
          <div style="min-height: 1rem;"></div>
          <toggle-button clicked @clicked="tab-group.more%hidden" small>
            <span slot="off">-close</span>
            <span slot="on">more...</span>
          </toggle-button>
          <tab-group class="more">
            <tab-button value="articles">Articles</tab-button>
          </tab-group>
        </tab-group>
      </nav>
    </side-panel>
  </div>
  <div style="display: flex; flex-direction: column; height: 100vh; flex-grow: 7;">
    <header style="display: grid; grid-template-columns: auto 1fr auto;">
      <toggle-button @clicked="side-panel:has(>nav)%opened" aria-label="Menu">
        <span slot="on">&lt;</span>
        <span slot="off">&gt;</span>
      </toggle-button>
      <h1 style="text-align: center;">TechniZlecenia</h1>
      <toggle-button @clicked="side-panel:has(login-form)%opened" aria-label="Profile">
        <profile-picture slot="off"></profile-picture>
        <span slot="on">X</span>
      </toggle-button>
    </header>
    <main style="flex-grow: 1; overflow-y: auto;">
      <paged-view @page="bookmark-list>div>if-equal-view%a">
        <div slot="about">
          <h2>A good enough platform for getting things done</h2>
          <h3>It's a work in progress made in
            <div>
              <span style="text-decoration: line-through;">three weeks</span>
              3 weekends + 4 days of sick leave
            </div>
            for a school project
            @<a href="https://www.technischools.com/">technischools</a>
          </h3>
        </div>
        <bookmark-list passthrough="jwt" $slot="if-equal-view%b" $jwt="router-view%jwt">
          <div slot="item">
            <if-equal-view>
              <router-view passthrough="jwt" route="[]" $jwt="query-search%jwt"
                origin='{"name": "Home/", "data":{}, "type": "home"}' @json="route-list%data">
                <div style="display: flex; flex-direction: row;">
                  <route-list $href="a%href" $text="a>text-display%content" $i="a%i"
                    style="display: flex; flex-direction: row;">
                    <div slot="item">
                      <a onclick="event.preventDefault();document.querySelector('if-equal-view[visible]>router-view').to(JSON.parse(this.getAttribute('i')))"
                        style="color: gray;">
                        <text-display></text-display>
                      </a>
                    </div>
                  </route-list>
                </div>
                <div slot="home">
                  <div>
                    <button type="button"
                      onclick="document.querySelector('if-equal-view[visible]>router-view').next({name: 'Search/', data: {}, type: 'search'})">
                      Search
                    </button>
                    <button type="button"
                      onclick="document.querySelector('if-equal-view[visible]>router-view').next({name: 'me', data: {id:null}, type: 'user'})">
                      My profile
                    </button>
                  </div>
                </div>
                <div slot="search">
                  <toggle-button @clicked="if-equal-view[visible] div[current] query-search%is_user">
                    <span slot="off">searching orders</span>
                    <span slot="on">searching users</span>
                  </toggle-button>
                  <input type="search" placeholder="Search"
                    oninput="document.querySelector('if-equal-view[visible] div[current] query-search').setAttribute('query', event.target.value)" />
                  <query-search @type="if-equal-view[visible] div[current] query-search>paged-view%page"
                    @data="if-equal-view[visible] div[current] query-search order-list%data;if-equal-view[visible] div[current] query-search user-list%data">
                    <paged-view>
                      <order-list slot="orders" $name="h3>text-display.name%content"
                        $price="h3 text-display.price%content" $description="p>text-display%content"
                        $order_id="small>text-display.order%content;button%order_id"
                        $created_at="small>text-display.created_at%content" $image_urls="image-list%data">
                        <div slot="item">
                          <h3>
                            <text-display class="name"></text-display>
                            <span style="font-weight: bold;"><text-display class="price"></text-display> PLN</span>
                            <button type="button"
                              onclick="document.querySelector('router-view[slot=browse]').root({name: `order-${this.getAttribute('order_id')}`, data: {id: JSON.parse(this.getAttribute('order_id'))}, type: 'order'})">
                              Details
                            </button>
                          </h3>
                          <p>
                            Description:
                            <br />
                            <text-display></text-display>
                          </p>
                          <div>
                            <image-list $src="%src">
                              <img slot="item" style="max-width: 200px; max-height: 200px;"></img>
                            </image-list>
                          </div>
                          <small>
                            <text-display class="order"></text-display>
                            created at <text-display class="created_at"></text-display>
                          </small>
                        </div>
                      </order-list>
                      <user-list slot="user" $id="profile-picture%user_id" $name="profile-picture+text-display%content">
                        <div slot="item">
                          <h3>
                            <profile-picture></profile-picture>
                            <text-display></text-display>
                          </h3>
                        </div>
                      </user-list>
                    </paged-view>
                  </query-search>
                </div>
              </router-view>
            </if-equal-view>
          </div>
        </bookmark-list>
        <div slot="offers">
          <query-my-offers @offers="query-my-offers>offer-list%data">
            <offer-list>
              <div slot="item">
                test
              </div>
            </offer-list>
        </div>
        <div slot="orders">
          <create-form address="/order" toupdate="query-my-orders%update" start='{"images": []}'>
            <form>
              <input type="text" name="order_name" placeholder="Name" required />
              <textarea name="order_desc" placeholder="Description" required></textarea>
              <input type="number" name="price" placeholder="Price" min="0" step="0.01" required />
              <input type="file" name="images" multiple />
              <button type="button" onclick="event.target.previousElementSibling.value = ''">Clear images</button>
              <button type="submit">Create</button>
            </form>
          </create-form>
          <query-my-orders @orders="query-my-orders>order-list%data">
            <order-list $name="h3>text-display.name%content" $price="h3 text-display.price%content"
              $description="p>text-display%content" $order_id="small>text-display.order%content;button%order_id"
              $created_at="small>text-display.created_at%content" $image_urls="image-list%data" $datum="button%order">
              <div slot="item">
                <h3>
                  <text-display class="name"></text-display>
                  <span style="font-weight: bold;"><text-display class="price"></text-display> PLN</span>
                  <button type="button"
                    onclick="document.querySelector('router-view[slot=browse]').root({name: `order-${this.getAttribute('order_id')}`, data: {id: JSON.parse(this.getAttribute('order_id'))}, type: 'order'})">
                    Details
                  </button>
                </h3>
                <p>
                  Description:
                  <br />
                  <text-display></text-display>
                </p>
                <div>
                  <image-list $src="%src">
                    <img slot="item" style="max-width: 200px; max-height: 200px;"></img>
                  </image-list>
                </div>
                <small>
                  <text-display class="order"></text-display>
                  created at <text-display class="created_at"></text-display>
                </small>
              </div>
            </order-list>
          </query-my-orders>
        </div>
        <div slot="articles">
          <span
            style="color: transparent; background: linear-gradient(to right, #FFF 50%, rgba(255, 255, 255, 0.1) 100%) text;">
            Comming soon...
          </span>
        </div>
      </paged-view>
    </main>
    <footer>
      <ul>
        <span>Repos:</span>
        <a href="https://github.com/UnnamedShadow/TechniZlecenia">Frontend</a>
        <a href="https://github.com/chrontax/techni-zlecenia-backend">Backend</a>
      </ul>
    </footer>
  </div>
  <div style="flex-basis: 300px; display: flex; justify-content: flex-end;">
    <side-panel>
      <login-form @logged-out="side-panel>query-profile%hidden"
        @jwt="profile-picture%jwt;query-profile%jwt;query-my-orders%jwt;create-form%jwt;owned-order-details%jwt;query-my-offers%jwt;bookmark-list%jwt">
        <form slot="register" style="border: blue 1px solid; border-radius: 4px;">
          <input type="text" name="username" placeholder="Username" required />
          <input type="email" name="email" placeholder="Email" required />
          <input type="password" name="password" placeholder="Password" required />
          <button type="submit">Register</button>
          <a href=""
            onclick="event.preventDefault(); document.querySelector('login-form').toggleAttribute('registering', false)"
            style="color: gray;">
            Already have an account?
          </a>
        </form>
        <form slot="login" style="border: blue 1px solid; border-radius: 4px;">
          <input type="username" name="username" placeholder="Username" required />
          <input type="password" name="password" placeholder="Password" required />
          <button type="submit">Log in</button>
          <a href=""
            onclick="event.preventDefault(); document.querySelector('login-form').toggleAttribute('registering', true)"
            style="color: gray;">
            Don't have an account?
          </a>
        </form>
      </login-form>
      <query-profile @username="query-profile>h2>text-display%content" @email="query-profile>h3>text-display%content"
        @id="query-profile>h4>text-display%content">
        <h2>
          <profile-picture></profile-picture>
          <text-display></text-display>
        </h2>
        <h3>
          <text-display></text-display>
        </h3>
        <h4>
          <text-display></text-display>
        </h4>
        <br />
        <button
          onclick="localStorage.removeItem('jwt'); document.querySelector('login-form').toggleAttribute('logged-out', true)">
          Log out
        </button>
        <button style="color: red;" onclick="document.querySelector('query-profile').delete()">
          Remove
        </button>
      </query-profile>
    </side-panel>
  </div>
</body>

</html>